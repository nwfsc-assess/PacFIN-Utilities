<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>First-Stage expansion for composition data — getExpansion_1 • PacFIN.Utilities</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="First-Stage expansion for composition data — getExpansion_1"><meta property="og:description" content="First-stage expansions account for unsampled fish in the smallest measured
unit. Where, in PacFIN data, the smallest measured unit typically a trip
because that is what is available to the port or dockside sampler. Whereas,
in survey data the smallest measured unit is typically a tow. Tow would be
the smallest if we had samples from onboard observers rather than from
dockside samplers."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PacFIN.Utilities</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/sablefish_example.html">Working through sablefish PacFIN data</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>First-Stage expansion for composition data</h1>

    <div class="hidden name"><code>getExpansion_1.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>First-stage expansions account for unsampled fish in the smallest measured
unit. Where, in PacFIN data, the smallest measured unit typically a trip
because that is what is available to the port or dockside sampler. Whereas,
in survey data the smallest measured unit is typically a tow. Tow would be
the smallest if we had samples from onboard observers rather than from
dockside samplers.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">getExpansion_1</span><span class="op">(</span></span>
<span>  <span class="va">Pdata</span>,</span>
<span>  <span class="va">fa</span>,</span>
<span>  <span class="va">fb</span>,</span>
<span>  <span class="va">ma</span>,</span>
<span>  <span class="va">mb</span>,</span>
<span>  <span class="va">ua</span>,</span>
<span>  <span class="va">ub</span>,</span>
<span>  maxExp <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  Exp_WA <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot <span class="op">=</span> <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="https://lifecycle.r-lib.org/reference/deprecated.html" class="external-link">deprecated</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  savedir <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-pdata">Pdata<a class="anchor" aria-label="anchor" href="#arg-pdata"></a></dt>
<dd><p>A data frame returned from <code><a href="PullBDS.PacFIN.html">PullBDS.PacFIN()</a></code> containing
biological samples. These data are stored in the Pacific Fishieries
Information Network (PacFIN) data warehouse, which originated in 2014 and
are pulled using sql calls.</p></dd>


<dt id="arg-fa-ma-ua">fa, ma, ua<a class="anchor" aria-label="anchor" href="#arg-fa-ma-ua"></a></dt>
<dd><p>Female-, male-, and unsexed-specific weight–length
coefficients for Stock Synthesis where the relationships were calculated
using length in cm and weight in kg. There are no default values. You must
calculate these values and pass them to the function. If a particular sex
does not pertain to your data, then just pass <code>NA</code> for that relationship.</p></dd>


<dt id="arg-fb-mb-ub">fb, mb, ub<a class="anchor" aria-label="anchor" href="#arg-fb-mb-ub"></a></dt>
<dd><p>Female-, male, and unsexed-specific weight–length exponents
for Stock Synthesis where the relationships were calculated using length in
cm and weight in kg. If a particular sex does not pertain to your data,
then just pass <code>NA</code> for that relationship.</p></dd>


<dt id="arg-maxexp">maxExp<a class="anchor" aria-label="anchor" href="#arg-maxexp"></a></dt>
<dd><p>The maximum expansion factor (either a number or a quantile)
for building expansions. Typically, the default is 0.95. Set <code>maxExp = Inf</code> to see largest values.</p></dd>


<dt id="arg-exp-wa">Exp_WA<a class="anchor" aria-label="anchor" href="#arg-exp-wa"></a></dt>
<dd><p>A logical values specifying if the samples from Washington
should be exanded. The default is <code>FALSE</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>A logical specifying if output should be written to the
screen or not. Good for testing and exploring your data but can be turned
off when output indicates information that you already know. The printing
of output to the screen does not affect any of the returned objects. The
default is to always print to the screen, i.e., <code>verbose = TRUE</code>.</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p>Typically, a logical is passed defining if you would like the
default plots to be created but users can also pass a string providing a
path to a directory where those plots will be stored. The default is
<code>FALSE</code> and no figures will be created unless this is changed. If <code>TRUE</code> is
passed, then the figures will be saved to your current working directory.</p></dd>


<dt id="arg-savedir">savedir<a class="anchor" aria-label="anchor" href="#arg-savedir"></a></dt>
<dd><p>A file path to the directory where the results will be saved.
The default is NULL.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A <code>data.frame</code> where all of the original columns in <code>Pdata</code> remain unaltered
but additional columns are added. In particular columns starting with
<code>Expansion_Factor_1</code> are available for setting the <code>Final_Expansion_Factor</code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The workflow is to run this function after <code><a href="cleanPacFIN.html">cleanPacFIN()</a></code>,
which assures that all of the necessary columns are available and that the
data are in the correct units. This function then calls two helper functions,
<code><a href="EF1_Numerator.html">EF1_Numerator()</a></code> and <code><a href="EF1_Denominator.html">EF1_Denominator()</a></code> to calculate the weight of sampled
fish and the weight of all fish of the respective species in the tow,
respectively. Finally, the ratio of the two values is returned. Alternatively,
users should consider using <code><a href="get_pacfin_expansions.html">get_pacfin_expansions()</a></code> which is a wrapper
function that calls both the first and second stage functions for expanding
composition data.</p>
    </div>
    <div id="expansion">
    <h2>Expansion</h2>


<ul><li><p>Age data are expanded separately from lengths.</p></li>
<li><p>WA fish are generally only expanded using Expansion_Factor_2.</p></li>
<li><p>Other expansions are the product of
Expansion_Factor_1 * Expansion_Factor_2.</p></li>
<li><p>For age-at-length comps, set Final_Expansion_Factor to 1 because
each fish represents only itself.</p></li>
</ul></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index">
<ul><li><p><code><a href="cleanPacFIN.html">cleanPacFIN()</a></code> (upstream)</p></li>
<li><p><code><a href="https://rdrr.io/pkg/nwfscSurvey/man/estimate_weight_length.html" class="external-link">nwfscSurvey::estimate_weight_length()</a></code> (upstream)</p></li>
<li><p><code><a href="EF1_Numerator.html">EF1_Numerator()</a></code> (contained within)</p></li>
<li><p><code><a href="EF1_Denominator.html">EF1_Denominator()</a></code> (contained within)</p></li>
<li><p><code><a href="getExpansion_2.html">getExpansion_2()</a></code> (downstream)</p></li>
</ul></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Andi Stephens, Kelli F. Johnson, Chantel R. Wetzel</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Calculate the weight--length parameters for input to this function</span></span></span>
<span class="r-in"><span><span class="va">bds_survey</span> <span class="op">&lt;-</span> <span class="fu">nwfscSurvey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nwfscSurvey/man/pull_bio.html" class="external-link">pull_bio</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  common_name <span class="op">=</span> <span class="st">"widow rockfish"</span>,</span></span>
<span class="r-in"><span>  survey <span class="op">=</span> <span class="st">"NWFSC.Combo"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu">nwfscSurvey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nwfscSurvey/man/estimate_weight_length.html" class="external-link">estimate_weight_length</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">bds_survey</span>,</span></span>
<span class="r-in"><span>  col_length <span class="op">=</span> <span class="st">"length_cm"</span>,</span></span>
<span class="r-in"><span>  col_weight <span class="op">=</span> <span class="st">"weight_kg"</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data_exp1</span> <span class="op">&lt;-</span> <span class="fu">getExpansion_1</span><span class="op">(</span></span></span>
<span class="r-in"><span>  Pdata <span class="op">=</span> <span class="va">bds_cleaned</span>,</span></span>
<span class="r-in"><span>  fa <span class="op">=</span> <span class="va">weight_length_estimates</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"female"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  fb <span class="op">=</span> <span class="va">weight_length_estimates</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"female"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="st">"B"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ma <span class="op">=</span> <span class="va">weight_length_estimates</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"male"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  mb <span class="op">=</span> <span class="va">weight_length_estimates</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"female"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="st">"B"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ua <span class="op">=</span> <span class="va">weight_length_estimates</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"all"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ub <span class="op">=</span> <span class="va">weight_length_estimates</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"all"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="st">"B"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  maxExp <span class="op">=</span> <span class="fl">0.95</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Kelli F. Johnson, Chantel R. Wetzel.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

